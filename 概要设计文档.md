# 校园二手交易平台概要设计文档

## 1. 引言

### 1.1 文档目的
本文档旨在详细描述校园二手交易平台的概要设计，包括系统架构、模块划分、数据库设计、接口设计等内容，为后续的详细设计和开发提供指导。

### 1.2 文档范围
本文档涵盖校园二手交易平台的整体架构设计、核心功能模块设计、数据库设计、接口设计等方面。

### 1.3 术语定义
- **闲置物品**：用户不再需要的二手物品
- **交易地点**：用户约定的物品交换地点
- **订单状态**：订单的处理阶段（待支付、已支付、已发货、已完成等）

## 2. 系统架构设计

### 2.1 整体架构
校园二手交易平台采用前后端分离的架构模式，具体包括：

- **前端层**：负责用户界面展示和交互
- **后端服务层**：处理业务逻辑和数据访问
- **数据层**：存储系统数据

### 2.2 技术架构

#### 2.2.1 前端技术栈
- **框架**：Vue.js 2.6
- **UI组件库**：Element UI
- **路由管理**：Vue Router
- **HTTP请求**：Axios

#### 2.2.2 后端技术栈
- **框架**：Spring Boot 2.4.0
- **ORM框架**：MyBatis
- **数据库**：MySQL 8.0
- **工具库**：Hutool、FastJson、Lombok

### 2.3 系统分层设计

#### 2.3.1 前端分层
- **表现层**：Vue组件，负责页面展示和用户交互
- **路由层**：Vue Router，负责页面路由管理
- **API层**：封装与后端的API交互
- **工具层**：通用工具函数

#### 2.3.2 后端分层
- **控制器层（Controller）**：处理HTTP请求和响应
- **服务层（Service）**：处理业务逻辑
- **数据访问层（Mapper）**：与数据库交互
- **实体层（Entity）**：数据模型定义
- **工具层（Utils）**：通用工具类

## 3. 模块划分和功能设计

### 3.1 前端模块划分

#### 3.1.1 路由模块（src/router）
- 定义系统所有路由
- 实现路由守卫，控制页面访问权限

#### 3.1.2 API模块（src/api）
- 封装所有与后端的API请求
- 统一处理请求和响应

#### 3.1.3 组件模块（src/components）
- 通用组件（如导航栏、分页组件等）
- 业务组件（如商品卡片、订单列表等）

#### 3.1.4 页面模块（src/views）
- 首页
- 商品详情页
- 发布商品页
- 个人中心页
- 订单页
- 收藏页
- 登录/注册页
- 后台管理页

#### 3.1.5 工具模块（src/utils）
- 请求工具（axios封装）
- 日期处理工具
- 通用工具函数

### 3.2 后端模块划分

#### 3.2.1 控制器模块（controller）
- UserController：用户管理相关接口
- IdleItemController：商品管理相关接口
- OrderController：订单管理相关接口
- AddressController：地址管理相关接口
- FavoriteController：收藏管理相关接口
- MessageController：消息管理相关接口
- AdminController：后台管理相关接口

#### 3.2.2 服务模块（service）
- UserService：用户相关业务逻辑
- IdleItemService：商品相关业务逻辑
- OrderService：订单相关业务逻辑
- AddressService：地址相关业务逻辑
- FavoriteService：收藏相关业务逻辑
- MessageService：消息相关业务逻辑
- AdminService：后台管理相关业务逻辑

#### 3.2.3 数据访问模块（mapper）
- UserMapper：用户数据访问
- IdleItemMapper：商品数据访问
- OrderMapper：订单数据访问
- AddressMapper：地址数据访问
- FavoriteMapper：收藏数据访问
- MessageMapper：消息数据访问
- AdminMapper：后台管理数据访问

#### 3.2.4 实体模块（entity）
- User：用户实体
- IdleItem：商品实体
- Order：订单实体
- Address：地址实体
- Favorite：收藏实体
- Message：消息实体
- Admin：管理员实体

#### 3.2.5 工具模块（utils）
- FileUtils：文件处理工具
- DateUtils：日期处理工具
- EncryptUtils：加密工具

## 4. 数据库设计

### 4.1 数据库表结构

#### 4.1.1 用户表（sh_user）
| 字段名 | 数据类型 | 长度 | 约束 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| user_id | int | 11 | PRIMARY KEY, AUTO_INCREMENT | 用户ID |
| phone | varchar | 20 | NOT NULL, UNIQUE | 手机号 |
| password | varchar | 100 | NOT NULL | 密码 |
| nickname | varchar | 50 | NOT NULL | 昵称 |
| avatar | varchar | 200 | | 头像 |
| create_time | datetime | | NOT NULL | 注册时间 |
| status | tinyint | 4 | NOT NULL | 用户状态（0：禁用，1：启用） |

#### 4.1.2 商品表（sh_idle_item）
| 字段名 | 数据类型 | 长度 | 约束 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| item_id | int | 11 | PRIMARY KEY, AUTO_INCREMENT | 商品ID |
| user_id | int | 11 | NOT NULL | 卖家ID |
| item_name | varchar | 100 | NOT NULL | 商品名称 |
| price | decimal | 10,2 | NOT NULL | 商品价格 |
| description | text | | NOT NULL | 商品描述 |
| images | varchar | 500 | | 商品图片（多个图片用逗号分隔） |
| category | tinyint | 4 | NOT NULL | 商品分类（1：数码，2：家电，3：户外，4：图书，5：其他） |
| address | varchar | 200 | NOT NULL | 交易地点 |
| create_time | datetime | | NOT NULL | 发布时间 |
| status | tinyint | 4 | NOT NULL | 商品状态（0：下架，1：上架，2：已卖出） |

#### 4.1.3 订单表（sh_order）
| 字段名 | 数据类型 | 长度 | 约束 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| order_id | int | 11 | PRIMARY KEY, AUTO_INCREMENT | 订单ID |
| order_no | varchar | 32 | NOT NULL, UNIQUE | 订单编号 |
| user_id | int | 11 | NOT NULL | 买家ID |
| item_id | int | 11 | NOT NULL | 商品ID |
| price | decimal | 10,2 | NOT NULL | 订单价格 |
| pay_status | tinyint | 4 | NOT NULL | 支付状态（0：未支付，1：已支付） |
| pay_type | tinyint | 4 | | 支付方式 |
| create_time | datetime | | NOT NULL | 创建时间 |
| pay_time | datetime | | | 支付时间 |
| status | tinyint | 4 | NOT NULL | 订单状态（0：待支付，1：已支付，2：已完成） |

#### 4.1.4 地址表（sh_address）
| 字段名 | 数据类型 | 长度 | 约束 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| address_id | int | 11 | PRIMARY KEY, AUTO_INCREMENT | 地址ID |
| user_id | int | 11 | NOT NULL | 用户ID |
| consignee | varchar | 50 | NOT NULL | 收货人姓名 |
| phone | varchar | 20 | NOT NULL | 收货人手机号 |
| province | varchar | 50 | NOT NULL | 省 |
| city | varchar | 50 | NOT NULL | 市 |
| district | varchar | 50 | NOT NULL | 区 |
| detail_address | varchar | 200 | NOT NULL | 详细地址 |
| is_default | tinyint | 4 | NOT NULL | 是否默认地址（0：否，1：是） |

#### 4.1.5 收藏表（sh_favorite）
| 字段名 | 数据类型 | 长度 | 约束 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| favorite_id | int | 11 | PRIMARY KEY, AUTO_INCREMENT | 收藏ID |
| user_id | int | 11 | NOT NULL | 用户ID |
| item_id | int | 11 | NOT NULL | 商品ID |
| create_time | datetime | | NOT NULL | 创建时间 |

#### 4.1.6 消息表（sh_message）
| 字段名 | 数据类型 | 长度 | 约束 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| message_id | int | 11 | PRIMARY KEY, AUTO_INCREMENT | 消息ID |
| user_id | int | 11 | NOT NULL | 用户ID |
| item_id | int | 11 | NOT NULL | 商品ID |
| content | text | | NOT NULL | 留言内容 |
| create_time | datetime | | NOT NULL | 创建时间 |
| reply_user_id | int | 11 | | 回复用户ID |
| reply_message_id | int | 11 | | 回复消息ID |

#### 4.1.7 管理员表（sh_admin）
| 字段名 | 数据类型 | 长度 | 约束 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| admin_id | int | 11 | PRIMARY KEY, AUTO_INCREMENT | 管理员ID |
| username | varchar | 50 | NOT NULL, UNIQUE | 账号 |
| password | varchar | 100 | NOT NULL | 密码 |
| name | varchar | 50 | NOT NULL | 姓名 |

#### 4.1.8 订单地址表（sh_order_address）
| 字段名 | 数据类型 | 长度 | 约束 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| address_id | int | 11 | PRIMARY KEY, AUTO_INCREMENT | 地址ID |
| order_id | int | 11 | NOT NULL | 订单ID |
| consignee | varchar | 50 | NOT NULL | 收货人姓名 |
| phone | varchar | 20 | NOT NULL | 收货人手机号 |
| address | varchar | 200 | NOT NULL | 详细地址 |

### 4.2 数据关系图

```
User 1 --- N IdleItem
User 1 --- N Order
User 1 --- N Address
User 1 --- N Favorite
User 1 --- N Message
IdleItem 1 --- N Order
IdleItem 1 --- N Message
Order 1 --- 1 OrderAddress
```

## 5. 接口设计

### 5.1 接口规范

#### 5.1.1 接口URL格式
```
http://localhost:8080/api/模块名/接口名
```

#### 5.1.2 请求方式
- GET：获取资源
- POST：创建资源
- PUT：更新资源
- DELETE：删除资源

#### 5.1.3 响应格式
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {}
}
```

### 5.2 用户管理接口

#### 5.2.1 用户注册
- **URL**：/api/user/register
- **请求方式**：POST
- **请求参数**：
  ```json
  {
    "phone": "13800138000",
    "password": "123456",
    "nickname": "test"
  }
  ```
- **响应参数**：
  ```json
  {
    "code": 200,
    "message": "注册成功",
    "data": {
      "user_id": 1,
      "phone": "13800138000",
      "nickname": "test"
    }
  }
  ```

#### 5.2.2 用户登录
- **URL**：/api/user/login
- **请求方式**：POST
- **请求参数**：
  ```json
  {
    "phone": "13800138000",
    "password": "123456"
  }
  ```
- **响应参数**：
  ```json
  {
    "code": 200,
    "message": "登录成功",
    "data": {
      "user_id": 1,
      "phone": "13800138000",
      "nickname": "test",
      "avatar": "avatar.jpg"
    }
  }
  ```

### 5.3 商品管理接口

#### 5.3.1 发布商品
- **URL**：/api/item/publish
- **请求方式**：POST
- **请求参数**：
  ```json
  {
    "item_name": "二手手机",
    "price": 1000.00,
    "description": "九成新手机",
    "images": "image1.jpg,image2.jpg",
    "category": 1,
    "address": "学校南门"
  }
  ```
- **响应参数**：
  ```json
  {
    "code": 200,
    "message": "发布成功",
    "data": {
      "item_id": 1,
      "item_name": "二手手机"
    }
  }
  ```

#### 5.3.2 获取商品列表
- **URL**：/api/item/list
- **请求方式**：GET
- **请求参数**：
  - page：页码
  - limit：每页数量
  - category：商品分类

- **响应参数**：
  ```json
  {
    "code": 200,
    "message": "查询成功",
    "data": {
      "total": 100,
      "list": [
        {
          "item_id": 1,
          "item_name": "二手手机",
          "price": 1000.00,
          "images": "image1.jpg",
          "category": 1,
          "address": "学校南门"
        }
      ]
    }
  }
  ```

### 5.4 订单管理接口

#### 5.4.1 创建订单
- **URL**：/api/order/create
- **请求方式**：POST
- **请求参数**：
  ```json
  {
    "item_id": 1,
    "address_id": 1
  }
  ```
- **响应参数**：
  ```json
  {
    "code": 200,
    "message": "订单创建成功",
    "data": {
      "order_id": 1,
      "order_no": "202306010001",
      "price": 1000.00
    }
  }
  ```

#### 5.4.2 获取订单列表
- **URL**：/api/order/list
- **请求方式**：GET
- **请求参数**：
  - page：页码
  - limit：每页数量
  - status：订单状态

- **响应参数**：
  ```json
  {
    "code": 200,
    "message": "查询成功",
    "data": {
      "total": 10,
      "list": [
        {
          "order_id": 1,
          "order_no": "202306010001",
          "item_name": "二手手机",
          "price": 1000.00,
          "status": 1
        }
      ]
    }
  }
  ```

## 6. 界面设计

### 6.1 首页
- 导航栏：包含logo、搜索框、发布按钮、个人中心入口
- 分类标签：数码、家电、户外、图书、其他
- 商品列表：展示商品卡片，包含商品图片、名称、价格、交易地点等信息
- 分页控件：用于翻页浏览商品

### 6.2 商品详情页
- 商品图片轮播
- 商品基本信息：名称、价格、发布时间、交易地点
- 商品描述
- 卖家信息：昵称、头像
- 操作按钮：收藏、购买、留言

### 6.3 个人中心页
- 个人信息：头像、昵称、手机号
- 功能菜单：我的发布、我的订单、我的收藏、地址管理

### 6.4 后台管理页
- 侧边栏：用户管理、商品管理、订单管理
- 数据表格：展示用户、商品、订单数据
- 操作按钮：添加、编辑、删除、审核等

## 7. 部署方案

### 7.1 开发环境部署
- **前端**：使用Vue CLI开发服务器，端口：8081
- **后端**：使用Spring Boot内置Tomcat，端口：8080
- **数据库**：MySQL，端口：3306

### 7.2 生产环境部署
- **前端**：构建静态文件后部署到Nginx
- **后端**：打包成jar包后部署到Tomcat或直接运行
- **数据库**：MySQL主从架构

## 8. 安全设计

### 8.1 认证与授权
- 用户认证：基于手机号和密码的登录认证
- 管理员认证：基于账号和密码的登录认证
- 权限控制：不同角色拥有不同的操作权限

### 8.2 数据安全
- 密码加密：使用BCrypt进行密码加密存储
- 敏感数据传输：使用HTTPS协议加密传输
- 防止SQL注入：使用MyBatis参数化查询

### 8.3 接口安全
- 接口签名：防止接口被篡改
- 请求频率限制：防止恶意请求

## 9. 性能设计

### 9.1 前端性能优化
- 组件懒加载：减少初始加载时间
- 图片懒加载：提高页面加载速度
- 缓存策略：合理使用浏览器缓存

### 9.2 后端性能优化
- 数据库索引：优化查询性能
- 连接池：提高数据库连接效率
- 缓存：使用Redis缓存热点数据

## 10. 总结

本文档详细描述了校园二手交易平台的概要设计，包括系统架构、模块划分、数据库设计、接口设计等内容。该设计方案基于前后端分离架构，采用了Vue.js、Element UI、Spring Boot、MyBatis等技术栈，能够满足校园二手交易平台的功能需求和性能要求。